# JDBC

![屏幕截图(112)](JDBC.assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(112).png)

![屏幕截图(113)](JDBC.assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(113).png)



1. 注册驱动Class.forName()

2. 获取连接DriverManager.getConnecti

   ```java
   String url="jdbc:mysql://127.0.0.1:3306/DB1";
   String username="root";
   String password="1234";
   Connection conn=DriverManager.getConnection(url,username,password);
   ```

3. 定义sql操作语句

   ```java
   String sql="update stu set math=10 where id=8";
   ```

4. 获取执行sql的对象Statement XXX = conn.createStatement();

   ```java
   Statement stmt=conn.createStatement();
   ```

5. 执行sql

6. 处理结果

7. 释放资源

   ***

   

   ## DriverManager

   * DriverManager(驱动管理类)：
     * 注册驱动DriverManager.registerDriver
     * 获取数据库连接

   它下面的registerDriver()注册驱动
                  getCconnection()获取连接,语法jdbc:mysql://ip地址:端口号/数据库名称【jdbc:mysql://127.0.0.1:3306/DB1】

```java
//获取连接
String url="jdbc:mysql://127.0.0.1:3306/DB1";
String username="root";
String password="1234";
Connection conn=DriverManager.getConnection(url,username,password);
```

***



## Connection

* Connection(数据库连接对象):
  * 获取执行sql的对象
    * 普通执行sql对象  Statement createStatement()
    * 预编译SQL的执行sql,防止sql注入 PreparedStatement preareStatement(sql)
    * 执行存储过程的对象 CallbleStatement prepareCall(sql)
  
  > int executeUpdate(sql):这个在下面(即参考回滚事务代码)
  >
  > 
  >
  > ResultSet executeQuery(sql):执行DQL语句，返回值是ResultSet结果集对象
  
  
  
  * 管理事务
    * 开启事务：setAutoCommit(boolean autoCommit)
    * 提交事务commit()
    * 回滚事务rollback()
  
  ```java
  try {
      //开启事务
      conn.setAutoCommit(false);
  
      int count1=stmt.executeUpdate(sql1);//受影响的行数
  
      //处理受影响的结果
      System.out.println(count1);
  
      int count2=stmt.executeUpdate(sql2);//受影响的行数
  
      //处理受影响的结果
      System.out.println(count2);
  
      //提交事务
      conn.commit();
  } catch (Exception throwables) {
      //回滚事务
      conn.rollback();
      throwables.printStackTrace();
  }
  ```



***



## Statement

* Statement作用:
  * 执行sql语句
    * int executeUpdate(sql):执行DML、DDL语句【DDL操作数据库，DML对数据进行增删改查】
      返回值:1.DML语句受影响的行数2.DDL语句执行后，执行成功也可能返回0
      
    * ResultSet executeQuery(sql)DQL语句
    
      ```java
      //定义sql
          String sql = "select * from stu";
      
          //获取执行sql对象,获取Statement对象
          Statement stmt = conn.createStatement();
      
          //5.执行sql
          ResultSet rs = stmt.executeQuery(sql);
      
          //6.处理结果，遍历所有数据
          while (rs.next()){
              //获取数据
              int id = rs.getInt(1);
              String name = rs.getString(2);
              double money = rs.getDouble(3);
      
              //输出
              System.out.println(id);
              System.out.println(name);
              System.out.println(money);
          }
          //7.释放资源
          rs.close();
          stmt.close();
          conn.close();
      
      }
      ```

* PreparedStatement作用
  * 预防sql注入![屏幕截图(110)](JDBC.assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(110).png)

